<!DOCTYPE html>
<html lang="en" ng-app="app1">
<head>
    <title>Wiadomości</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="js/messagesModule.js"></script>

    <style>
        a.a1:link{
            background-color: slategrey;
            color: white;
            padding: 14px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }
        a.a1:hover{
            background-color: darkslategrey;

        }
    </style>

</head>
<body onload="getCookie();" onload="passCookie();" ng-init="ps(pass)" style="background-color:#e6e6ff;">
<div style="background-color:lightslategrey;">
    <div class="row" >
        <div class="col-sm-3"></div>
        <div class="col-sm-6" align="middle">
            <div class="btn-group btn-group-lg" role="group" >
                <a class="a1" href="board.html" style="color:white;">Ogłoszenia</a>
                <a class="a1" style="color:white; background-color: darkslategrey;" href="msg.html">Wiadomości</a>
                <a class="a1" style="color:white; " href="add.html">Dodaj ogłoszenie</a>
            </div>
        </div>
        <div class="col-sm-3" align="center" id="test">
            <form>
                Witaj <l style="color:greenyellow;" id="ckie"></l><br>
                <a id="log" onclick="resCookie()" style="color:blue;" href="index.html">Wyloguj</a>
            </form>
        </div>
    </div>
</div>

<div class="container">

    <br>
    <div class="row" ng-controller="tableCtrl">
        <div class="col-sm-6" align="right" >
            <div class="table-responsive" ng-init="getAllUsers()">
                <input type="text" class="form-control" id="pass" ng-model="passs">

                    <div ng-repeat="u in users|filter:{email: passs}:true">
                        {{cUser=u.id}}
                    </div>

                <!--<div id="pass" >Current user: {{cUser=}}</div>  damian.michalski@student.put.poznan.pl-->
                <div>{{passs}}</div>
                <table class="table table-bordered table-sm" ng-init="getAllMessages()">
                    <thead>
                    <tr>
                        <th colspan="4" style="text-align: center;">Archiwum wiadomości wysłanych</th>
                    </tr>
                    <tr>
                        <th>Nr</th>
                        <th>Użytkownik</th>
                        <th>Odbiorca</th>
                        <th>Treść</th>
                        <th>Data</th>
                    </tr>
                    <tr ng-repeat="message in messages|filter:{senderId: cUser}:true" ng-init="getUser(message.senderId)" ng-init="getAllUsers()">
                        <td>{{$index}}</td>
                        <td >{{user.lastname}}</td>
                        <td ng-repeat="xx in users|filter:{id: message.recipientId}:true">{{xx.lastname}}</td>
                        <td>{{message.content}}</td>
                        <td>{{message.timestamp | date:'dd-MM-yy HH:mm:ss'}}</td>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>

        <div class="col-sm-6" align="right">

            <div class="row" ng-controller="tableCtrl">

                    <div class="table-responsive" ng-init="getAllUsers()">
                        <l>  </l>
                        <table class="table table-bordered table-sm" ng-init="getAllMessages()">
                            <thead>
                            <tr>
                                <th colspan="4" style="text-align: center;">Archiwum wiadomości odebranych</th>
                            </tr>
                            <tr>
                                <th>Nr</th>
                                <th>Użytkownik</th>
                                <th>Nadawca</th>
                                <th>Treść</th>
                                <th>Data</th>
                            </tr>
                            <tr ng-repeat="message in messages|filter:{recipientId: cUser}:true" ng-init="getUser(message.recipientId)" ng-init="getAllUsers()">
                                <td>{{$index}}</td>
                                <td ng-click="getUser(user.id)" >{{user.lastname}}</td>
                                <td ng-repeat="xx in users|filter:{'id': message.senderId}:true">{{xx.lastname}}</td>
                                <td>{{message.content}}</td>
                                <td>{{message.timestamp | date:'dd-MM-yy HH:mm:ss'}}</td>
                            </tr>
                            </thead>
                        </table>

                </div>
            <!--<div class="text-center">
<textarea style="resize: none;" id="ta2" ng-model="texta" readonly rows="15" cols="40">

</textarea>-->


            </div>
        </div>
        <div class="col-sm-12" align="center"><form>
            <input type="number" ng-model="senderId" ng-value="2" style="display: none;">
            <input type="number" ng-model="recipientId" ng-value="25" text-align="center"><br>
            <input type="hidden" ng-model="timestamp" ng-value="timestamp">
            <div id="timestamp" style="display: none;"></div>
            <textarea ng-model="content" style="resize: none;" rows="1" cols="40">
                    </textarea><br>
            <button ng-click="addMsg(senderId, recipientId, timestamp, content)" style="width:307px">Wyślij</button>
        </form></div>
    </div>
</div>

<script>

    function passCookie() {
        document.getElementById("pass").innerHTML=document.getElementById("ckie").value;
    }

    function resCookie() {
        lo=document.getElementById("log").value;
        document.cookie = "login2=" + " " + ";";
    }
    function getCookie() {
        var name = "login2=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');

        for(var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                document.getElementById("ckie").innerHTML = c.substring(name.length, c.length);
                document.getElementById("pass").innerHTML = c.substring(name.length, c.length);
                document.getElementById("pass").value = c.substring(name.length, c.length);
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

</script>

</body>
</html>
